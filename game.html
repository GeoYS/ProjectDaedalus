<div id="main" style="overflow: hidden">
		<div id="map" style="z-index: -1; position: absolute;">	
		</div>
		<p id="mapDimensions"></p>
</div>
<script type="text/javascript">
	database.ref('game/world/map').on('value', function(snapshot) {
		var map = snapshot.val();
		var tilesWide = map['tilesWide'];
		var tilesHigh = map['tilesHigh'];
		var mapDiv = $('#map');
		
		$('#mapDimensions').html('Map dimensions: ' + tilesWide + 'x' + tilesHigh);
		
		for(var y = 0; y < tilesHigh; y ++) {
			var row = 'row' + y;
			$('#map').append('<div id=\'' + row + '\'></div>');
			$('#' + row).width(tilesWide * 100);
			
			for(var x = 0; x < tilesWide; x ++) {
				var coord = x + ',' + y;
				$('#' + row)
					.append(
						'<div class=\'tile ' + map['tiles'][coord]['properties']['tileType'] + '\' ' + 'id=\'' + coord + '\'></div>');
			}
		}
	});
	
	var lastX, lastY;
	var isDragging = false;
	
	$(document)
	.mousedown(function(event) {
		lastX = event.pageX;
		lastY = event.pageY;
		isDragging = true;
	})
	.mousemove(function(event) {
		if(isDragging) {
			var map = $('#map')
			var oldOffset = map.offset();
			var newOffsetX = oldOffset['left'] + event.pageX - lastX;
			var newOffsetY = oldOffset['top'] + event.pageY - lastY;
			
			if(newOffsetX > 300) {
				newOffsetX = 300;
			}
			if(newOffsetX < -3300 + $(window).width()) {
				newOffsetX = -3300  + $(window).width();
			}
			
			if(newOffsetY > 300) {
				newOffsetY = 300;
			}
			if(newOffsetY < -3300 + $(window).height()) {
				newOffsetY = -3300 + $(window).height();
			}
			
			map.offset({
				top: newOffsetY,
				left: newOffsetX
			});
			
			lastX = event.pageX;			
			lastY = event.pageY;
			
			isDragging = true;
		}
	})
	.mouseup(function(event) {
		isDragging = false;
	});
</script>